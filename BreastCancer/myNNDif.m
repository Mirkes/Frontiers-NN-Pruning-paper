function [y1, sensIndic] = myNNDif(x1, t, W)
%MYNN neural network simulation function.
%
% Auto-generated by MATLAB, 20-Oct-2021 12:20:52.
% 
% [y1] = myNN(x1, t, IW1_1) takes these arguments:
%   x = 730xQ matrix, input #1
%   t = 10xQ matrix of required labels, input #2
%   W = 10x30 matrix of weights of the hidden layer, input #3
% and returns:
%   y = 2xQ matrix, output #1
%   sensIndic = 1x30 vector of the first level sensetivity indicators,
%       output #2
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [6.981;9.71;43.79;143.5;0.05263;0.01938;0;0;0.106;0.04996;0.1115;0.3602;0.757;6.802;0.001713;0.002252;0;0;0.007882;0.0008948;7.93;12.02;50.41;185.2;0.07117;0.02729;0;0;0.1565;0.05504];
x1_step1.gain = [0.0946566330635619;0.0676361176868448;0.0138207449381522;0.000848356309650053;18.0554301706238;6.13459296975646;4.68603561387066;9.9403578528827;10.1010101010101;42.12299915754;0.724244070251675;0.442008486562942;0.094237383970221;0.00373553879543816;67.9878981541286;15.0208790218404;5.05050505050505;37.8859632506156;28.1420611245568;69.096085015823;0.0711490572749911;0.0533049040511727;0.00996065541112605;0.000491545418796697;13.2074225714852;1.94041000863482;1.59744408945687;6.87285223367698;3.9424403705894;13.1181949363768];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.5353416755114628334;1.1524332920893833876;1.0053995251729552773;1.0714368419572837254;-0.16722297030969329734;0.10052555997934979615;-0.28555454475682201521;1.0818838456281789639;1.2259664395916036739;1.5021543163473833893];
%IW1_1 = [0.22426593556657481443 0.21600317701494445299 -0.5032489152563383028 -0.47580400464774186275 0.18841033017776243064 -0.23912652310996881933 -0.43616058545430136384 -0.36412785615789372562 -0.44332755428521197771 0.24472431695596497114 -0.46367164981183772721 -0.20028782537408748587 -0.095196303930347961342 0.16845798535882569591 -0.43765434088192189943 -0.26986408510316950426 0.028129806652303222109 0.067884766906499693917 0.17267222193108441863 -0.22918323297490045265 0.0092109541238653835915 0.021851084041898366506 -0.15396498289324520026 -0.077986392687155001169 -0.46165194631361056166 0.38864721676783564597 -0.056894922536730424545 0.13534471251661042701 0.010803524394776442552 -0.33508680350334923981;0.15253775035395603088 0.61921327217748645122 0.27059402756365452669 0.37360192185304896828 0.4490372822539628328 -0.37323998984572687165 0.44296860689949579815 0.5629315566201513743 0.073897242982735825145 0.17654322179263359782 0.4946518597043599863 -0.27024704266461979651 -0.010964604819884180703 0.047805234823530703969 -0.29669531074185323538 0.37234470222681242957 -0.099222556106800280373 0.53494553684802592652 -0.035364991847351069654 -0.12584271064206509205 0.41882381401647633679 0.45183889957034556462 0.037347499595167539532 -0.22463720319496865985 0.54164507195418287733 -0.17979802835314043219 -0.1850480050271832988 0.2183263258007773211 -0.11969671219543416563 -0.24386686162140611134;-8.257946320137715332e-06 0.22702665722575735008 0.69150289020978050747 0.31361950948285410856 0.2829919462868811797 0.26951730150238378814 0.12719589430346750492 -0.24005769627094455942 0.11212260054846380497 -0.60835252915658777351 -0.0075792445183075016907 -0.09275931810928138288 0.19592108347177222827 -0.038568152313550325971 -0.042183851736833713475 0.27271746188552764556 -0.1034873961454391561 -0.34558019349732066461 0.38929496592970258551 0.17635306415317600348 0.40541640572792053687 0.23787780569135041908 0.67260450397321125404 0.13157782816269161796 0.48620642801058994165 -0.36269577976834194155 0.42162300605494390515 0.33992636742583215437 -0.086131366872637449283 0.13910434538154090034;-0.26644543399691744678 0.27069024210004466457 0.25320366220362255927 -0.70699731828686640522 -0.015785278750665307501 -0.08008002583994164314 -0.17711079487057615478 0.23412833662503781951 -0.016364888614296718705 -0.39273796358943086071 -0.20681598113974447584 -0.54127398760625444751 -0.18003376573280302497 -0.31893938622905276814 0.10520127793006439632 -0.84638271447052326746 -0.35366499725847033719 -0.33415331572366785418 -0.24278900622237498119 -0.68885167656174062234 0.021282002574991645827 0.24366014426717466645 0.34057677493373861299 0.16222143108984252158 -0.12633338313372888262 -0.37376702421342239413 -0.44810549939925187202 0.27985248511543275862 -0.45523829440310259464 0.11638072555138806452;0.3452374253629730827 0.10236262504667643924 -0.041914214197651074312 0.11843120744158650015 0.19480924821476836017 -0.40103362268423542458 -0.5189517599352140298 -0.2761864274094881222 -0.00096884687393456706168 0.022893438987765517278 -0.41592502042957657515 0.50831602821149390881 0.19400040579285018905 0.15728869370236239766 -0.087726448299920975482 0.38315055604282971524 -0.14648470724699605428 0.083453970340823052654 -0.090420529560760812271 0.034096706188459773024 -0.55019470889013577519 -0.32228404640744451326 0.17396068396964062264 0.27275915915785875487 -0.00020224882032931484487 -0.46629035764526099994 -0.26389246336209276622 0.32576338129728438231 -0.12317348915415807231 -0.15553003975458878916;0.39690139725440443108 -0.44371662816103835114 -0.45747753580780670113 -0.43908701413155865056 0.030930418169434144987 -0.29666567011271971488 -0.067591947805912849789 0.079004696084613745821 -0.095564481553346389275 -0.22878572897591686885 -5.7313333338636802137e-05 -0.034797366265593140944 -0.27177948630228476734 0.34126163838155726404 -0.4183656006222628565 0.49314874160435023809 -0.28278940388982548582 0.27299846912320130388 -0.12499394297442381618 -0.1016745116576139446 0.014272478256491527571 -0.07959686713751731868 -0.39656681312265540384 -0.071625209737632117291 0.16292354145256834896 0.035777625047018465909 -0.12834432976734011511 0.39886959055869791735 -0.26690234128336881581 -0.0033282948710762613395;-0.061933237397013833625 -0.0043588677114904323187 0.43205742578323169667 0.33011491315064717122 -0.01845859048739759839 -0.3139401336436218326 0.43741149910722432193 0.52886419467583245524 0.0082438987276386432868 -0.19073433201737516329 0.70673131495142194058 -0.089969791256657882794 0.10725718297264388856 -0.081336666423401482451 -0.1676075445091284033 -0.15984704018454551355 -0.076787942597352373819 -0.32248597021044089761 -0.71069178810346556041 -0.34040287486442577514 0.11275309689385749901 0.50154144344569095981 0.68130337501648019494 -0.29949654342808790242 0.14424171268233201837 -0.56060613841608586405 -0.062940447758907558384 0.37450227198003677165 -0.0068533368617629481304 -0.25198848131428602803;0.72140552996923978935 0.12017951912728258579 0.46562360792185641944 -0.003288986960410325306 -0.224680114000486153 -0.01476441314027575856 0.045025667719349862783 0.74780351812222067842 0.1972672407926189253 -0.11123947851095666861 0.60557753294384097931 -0.16056831009807095989 -0.088106888709624173184 0.22034190365398076406 -0.3972229704267656869 -0.44275066589476597123 -0.4181930668545862928 0.063412387160330832558 -0.30457448158660038739 -0.6935430809287012055 0.25249238880893459802 1.0033839860080246975 0.55934240542888757908 0.41924590489668533966 0.66603526189245454425 0.29575525496495613798 0.33753690717773798813 0.72572770203068814876 0.55950716219411766872 0.085712529655572411436;4.8742699255436934742e-05 -0.46298841673133545038 0.058049055745453201349 0.12180091409121750201 -0.3396418264336528714 -0.1474400142731632779 -0.099593962140450173481 -0.3208864942306848822 0.28475459251062368304 -0.27434802946169062343 -0.15342081519236755449 -0.4215159963270430632 0.1164105876936508549 -0.3124024358708044069 0.36503429375214052621 0.23986658697309831689 0.033530781322262850908 0.22607056614908657699 -0.14280298789203008103 -0.50899047501080285638 -0.032062306701411413812 0.2960575542251978054 0.21987804214789880008 0.32181808249092019869 0.48489538046508673386 -0.021437689805486034866 -0.12864356049805580895 0.29100451482125927472 -0.36318097775848545705 0.19905151697009904055;0.36211514386461535198 0.23768768547818580616 0.12171509527667082051 0.12971833246619449143 -0.37516444348141336773 -0.21107492329134822096 -0.22484676035713085929 -0.06680661121359306176 -0.35929019008812446145 -0.48382077653805311002 -0.037827882631621026488 -0.07955041519405610384 0.49211501621320558053 -0.35244585899045899335 -0.064490591130048555146 -0.19641496707639502506 0.097536417368982789022 -0.49805119353773413815 -0.22272672982628136107 -0.056824511435565591699 -0.13106431984645866562 0.1708227825306420089 0.27277952058087168163 0.46598296971782887654 0.3847793927651685375 -0.32755286368857222667 0.014738099922631255415 -0.11689363985347411834 -0.37363371960547564488 0.00020744551041433433687];

% Layer 2
b2 = [0.087453523312812586621;0.40412843307273410565];
LW2_1 = [0.84904722421966938306 -1.2076034933581942798 -0.42514131519977921281 -1.3481965294165987324 0.69845761190939226193 0.46361693049346308637 -0.7936050291650666999 -1.5941633664119569946 -0.15540789575602931283 0.10967831223331338253;-0.15906437192034753036 0.48738957110643899018 1.2979348513811701515 1.2849672812609664874 0.46761988428143941299 -0.60013069098288496228 1.283105466941607542 1.8595999363618163081 -0.59893431989679801752 0.55529481436598515653];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,2); % samples

% Input 1
xp1 = mapminmax_apply(x1,x1_step1);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + W*xp1);

% Layer 2
a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);

% Output 1
y1 = a2;
% Derivative calculation
dHdz = t - a2;
dHda1 = LW2_1' * dHdz;
dHds = -dHda1 .* ((a1 - 1) .^ 2);
dHdxp1 = W' * dHds;
chiip = abs(dHdxp1 .* xp1);
sensIndic = sum(chiip, 2);
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numerator = exp(n);
  denominator = sum(numerator,1); 
  denominator(denominator == 0) = 1;
  a = bsxfun(@rdivide,numerator,denominator);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end